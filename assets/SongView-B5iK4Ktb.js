import{_ as x,L as S,M as C,N as v,O as A,y as h,z as D,I as k,e as g,h as b,q as V,G as P,P as _,i as I,g as M,r as d,o as c,c as m,a as e,B as O,t as n,A as q,E,k as p,D as F,b as u,w as N,Q as L,F as z,m as B}from"./index-D5CaGYME.js";const U={name:"SongView",data(){return{comments:[],song:{},schema:{comment:"required|min:3"},commentInSubmission:!1,commentShowAlert:!1,commentAlertVariant:"bg-blue-500",commentAlertMessage:"Please wait! Your comment is being submitted.",sortingOrder:"latest"}},computed:{...S(C,["userLoggedIn"]),sortedComments(){return this.comments.slice().sort((s,o)=>this.sortingOrder==="latest"?new Date(o.datePosted)-new Date(s.datePosted):new Date(s.datePosted)-new Date(o.datePosted))}},methods:{...v(A,["newSong"]),async addComment(s,{resetForm:o}){this.commentInSubmission=!0,this.commentShowAlert=!0,this.commentAlertVariant="bg-blue-500",this.commentAlertMessage="Please wait! Your comment is being submitted.";const r={content:s.comment,datePosted:new Date().toString(),sid:this.$route.params.id,name:h.currentUser.displayName,uid:h.currentUser.uid};await D(_,r),this.song.commentCount+=1,await k(g(b,this.$route.params.id),{commentCount:this.song.commentCount}),this.getComments(),this.commentInSubmission=!1,this.commentShowAlert=!0,this.commentAlertVariant="bg-green-500",this.commentAlertMessage="Comment submitted successfully!",o()},async getComments(){const s=V(_,P("sid","==",this.$route.params.id)),o=await I(s);this.comments=[],o.forEach(r=>{this.comments.push({docID:r.id,...r.data()})})}},async beforeRouteEnter(s,o,r){const l=await M(g(b,s.params.id));r(t=>{if(!l.exists()){t.$router.push({name:"home"});return}t.song=l.data(),t.getComments();const{sort:i}=t.$route.query;i==="oldest"||i==="latest"?t.sortingOrder=i:t.sortingOrder="latest"})},watch:{sortingOrder(s){s!==this.$route.query.sort&&this.$router.push({query:{sort:s}})}}},Y={class:"relative mb-8 w-full py-14 text-center text-white"},G=e("div",{class:"music-bg absolute inset-0 box-border h-full w-full bg-contain",style:{"background-image":"url(/assets/img/song-header.png)"}},null,-1),Q={class:"container mx-auto flex items-center"},R=["disabled"],j=e("i",{class:"fas fa-play"},null,-1),H=[j],J={class:"z-50 ml-8 text-left"},K={class:"text-3xl font-bold"},T={class:"song-price"},W={class:"container mx-auto mt-6",id:"comments"},X={class:"relative flex flex-col rounded border border-gray-200 bg-white"},Z={class:"border-b border-gray-200 px-6 pb-5 pt-6 font-bold"},$={class:"card-title"},ee=e("i",{class:"fa fa-comments float-right text-2xl text-green-400"},null,-1),te={class:"p-6"},se=e("button",{type:"submit",class:"block rounded bg-green-600 px-3 py-1.5 text-white"}," Submit ",-1),oe=e("option",{value:"latest"},"Latest",-1),ne=e("option",{value:"oldest"},"Oldest",-1),re=[oe,ne],ae={class:"container mx-auto"},ie={class:"mb-5"},ce={class:"font-bold"};function me(s,o,r,l,t,i){const f=d("VeeField"),w=d("ErrorMessage"),y=d("VeeForm");return c(),m("main",null,[e("section",Y,[G,e("div",Q,[e("button",{onClick:o[0]||(o[0]=O(a=>s.newSong(t.song),["prevent"])),type:"button",class:"z-50 h-24 w-24 rounded-full bg-white text-3xl text-black focus:outline-none",disabled:t.commentInSubmission},H,8,R),e("div",J,[e("div",K,n(t.song.modifiedName),1),e("div",null,n(t.song.genre),1),e("div",T,n(s.$n(1,"currency","cn")),1)])])]),e("section",W,[e("div",X,[e("div",Z,[e("span",$,n(s.$tc("song.commentCount",t.song.commentCount,{count:t.song.commentCount})),1),ee]),e("div",te,[t.commentShowAlert?(c(),m("div",{key:0,class:q(["mb-4 p-4 text-center font-bold text-white",t.commentAlertVariant])},n(t.commentAlertMessage),3)):E("",!0),p(u(y,{"validation-schema":t.schema,onSubmit:i.addComment},{default:N(()=>[u(f,{as:"textarea",name:"comment",class:"mb-4 block w-full rounded border border-gray-300 px-3 py-1.5 text-gray-800 transition duration-500 focus:border-black focus:outline-none",placeholder:"Your comment here..."}),u(w,{name:"comment",class:"text-red-500"}),se]),_:1},8,["validation-schema","onSubmit"]),[[F,s.userLoggedIn]]),p(e("select",{"onUpdate:modelValue":o[1]||(o[1]=a=>t.sortingOrder=a),class:"mt-4 block rounded border border-gray-300 px-3 py-1.5 text-gray-800 transition duration-500 focus:border-black focus:outline-none"},re,512),[[L,t.sortingOrder]])])])]),e("ul",ae,[(c(!0),m(z,null,B(i.sortedComments,a=>(c(),m("li",{class:"border border-gray-200 bg-gray-50 p-6",key:a.docID},[e("div",ie,[e("div",ce,n(a.name),1),e("time",null,n(a.datePosted),1)]),e("p",null,n(a.content),1)]))),128))])])}const de=x(U,[["render",me]]);export{de as default};
